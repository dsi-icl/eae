version: '3'
services:
    mongodb:
        image: mongo:latest@sha256:3a09cd85fb4e76f1d5832f9ea1d4e7481f76e807389b7d8ea6ac4d4ba96f83e5
        environment:
          - MONGO_DATA_DIR=/data/mongodb
          - MONGO_LOG_DIR=/dev/null
          - MONGODB_DBNAME=eae
        command: mongod --smallfiles --logpath=/dev/null # --quiet
        ports:
          - 27017:27017

    mongodb-initialize:
        image: aoehmich/eae-mongodb-initialize:latest@sha256:073080877fb99ab7c6cdb6c6e56626c62ba2c2092efb7f357e2f75e855c16f70
        depends_on:
          - mongodb
        links:
          - mongodb

    swift:
        image: bouncestorage/swift-aio:latest@sha256:089cad2692dd711e52d43c724ac7bd2b5fff4e9566416cdc7cb11412606a49a3
        ports:
          - 8080:8080

    compute1:
        image: aoehmich/eae-compute:latest@sha256:6e9afa7afcbbf0b0bde34f8eedbd48f5badc729ab87c98c10b560801f14dec26
        depends_on:
          - mongodb
          - swift
        links:
          - mongodb
          - swift
        volumes:
          - ./eae.compute.config.js:/usr/app/config/eae.compute.config.js

    compute2:
        image: aoehmich/eae-compute:latest@sha256:6e9afa7afcbbf0b0bde34f8eedbd48f5badc729ab87c98c10b560801f14dec26
        depends_on:
          - mongodb
          - swift
        links:
          - mongodb
          - swift
        volumes:
          - ./eae.compute.config.js:/usr/app/config/eae.compute.config.js

    scheduler:
        image: aoehmich/eae-scheduler:latest@sha256:f40aeb4e1c5f57fb9598430c57a7529ca18474e3b301cbc4d5781af54a83b610
        depends_on:
          - compute1
          - compute2
        links:
          - mongodb
          - swift
        volumes:
          - ./eae.scheduler.config.js:/usr/app/config/eae.scheduler.config.js

    carrier:
        image: aoehmich/eae-carrier:latest@sha256:605ec2084fb09b271bf14a20c2da0286eb3cb556ff8a899d71f2af5b3c82210e
        depends_on:
          - scheduler
        links:
          - mongodb
          - swift
        ports:
          - 3000:3000
        volumes:
          - ./eae.carrier.config.js:/usr/app/config/eae.carrier.config.js

    interface:
        image: aoehmich/eae-interface:latest@sha256:75f66665b32acbe0f89a1c9a0e29d4a5a1803435455b77203c471492699e8493
        depends_on:
          - carrier
        links:
          - mongodb
        ports:
          - 80:80
        volumes:
          - ./eae.interface.config.js:/usr/app/config/eae.interface.config.js
