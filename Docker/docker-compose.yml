version: '3'
services:
    mongodb:
        image: mongo:latest@sha256:89672f72dde6ec88618fcfa2fd11a45d147cbd7df97573c227ff8d80131c3c53
        environment:
          - MONGO_DATA_DIR=/data/mongodb
          - MONGO_LOG_DIR=/dev/null
          - MONGODB_DBNAME=eae
        command: mongod --smallfiles --logpath=/dev/null # --quiet
        ports:
          - 27017:27017

    mongodb-initialize:
        image: aoehmich/eae-mongodb-initialize:latest@sha256:9754cdf025841d774edd5c69018a45484911aa07a6519ab192dc9e989ab760ab
        depends_on:
          - mongodb
        links:
          - mongodb

    swift:
        image: bouncestorage/swift-aio:latest@sha256:089cad2692dd711e52d43c724ac7bd2b5fff4e9566416cdc7cb11412606a49a3
        ports:
          - 8080:8080

    compute1:
        image: aoehmich/eae-compute:latest@sha256:1924fe12504fe4d5c1f488a8ed248de3a1df48fee9b74b4132e29a2f4aaaa9a0
        depends_on:
          - mongodb
          - swift
        links:
          - mongodb
          - swift
        volumes:
          - ./eae.compute.config.js:/usr/app/config/eae.compute.config.js

    compute2:
        image: aoehmich/eae-compute:latest@sha256:1924fe12504fe4d5c1f488a8ed248de3a1df48fee9b74b4132e29a2f4aaaa9a0
        depends_on:
          - mongodb
          - swift
        links:
          - mongodb
          - swift
        volumes:
          - ./eae.compute.config.js:/usr/app/config/eae.compute.config.js

    scheduler:
        image: aoehmich/eae-scheduler:latest@sha256:894ed27aef703be511f9e88b415862c78c242f5771c758a45b2770d99232bf73
        depends_on:
          - compute1
          - compute2
        links:
          - mongodb
          - swift
        volumes:
          - ./eae.scheduler.config.js:/usr/app/config/eae.scheduler.config.js

    carrier:
        image: aoehmich/eae-carrier:latest@sha256:c4d657eab7890f6fdd10b4a7ef51ab9cb477347fd0b716820bad6ba742a21c20
        depends_on:
          - scheduler
        links:
          - mongodb
          - swift
        ports:
          - 3000:3000
        volumes:
          - ./eae.carrier.config.js:/usr/app/config/eae.carrier.config.js

    interface:
        image: aoehmich/eae-interface:latest@sha256:b9dbad5130543bce5c2b9e81e9e2439c9ce55155d187b6cb78538b9e76c1e088
        depends_on:
          - carrier
        links:
          - mongodb
        ports:
          - 80:80
        volumes:
          - ./eae.interface.config.js:/usr/app/config/eae.interface.config.js
